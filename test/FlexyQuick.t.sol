// // SPDX-License-Identifier: MIT
// pragma solidity ^0.8.0;

// import "../src/Flexy.sol";
// import "ds-test/test.sol";
// import "forge-std/Script.sol";

// // import "openzeppelin-contracts/contracts/token/ERC20/ERC20.sol";

// contract FlexyQuick is DSTest, Script {
//     Flexy flexy;
//     IERC20 usdce = IERC20(0x1B6382DBDEa11d97f24495C9A90b7c88469134a4);
//     address relayer = 0x757EEB3E60d0D3f9a8a34A8540AB6c88eB058e49;

//     function setUp() external {
//         string memory rpc = "https://rpc.ankr.com/avalanche/";
//         uint256 forkId = vm.createFork(rpc);
//         vm.selectFork(forkId);

//         flexy = Flexy(payable(0xA5119606318100C5CDCa21622b79719693476B1e));
//         // g = new GasBot(relayer, relayer);
//         console.log("Flexy address: %s", address(flexy));
//     }

//     // ============================
//     // Test Implementation Update
//     // ============================
//     function test_getTokenBalances() external {
//         address[] memory tokens = new address[](1);
//         tokens[0] = address(usdce);
//         flexy.getTokenBalancesAndPermit2Allowances(relayer, tokens);
//     }

//     // function test_relayAndTransfer() external {
//     //     //         function relayAndTransfer(
//     //     //         address _sender,
//     //     //         address _token,
//     //     //         uint256 _amount,
//     //     //         bytes calldata _permitData,
//     //     //         address _target,
//     //     //         bytes calldata _data,
//     //     //         uint256 _sendAmount,
//     //     //         address _weth
//     //     //     )

//     //     // ['0xe2b8e07b913af9ED2b13808e48F2303964276651', '0xdAC17F958D2ee523a2206206994597C13D831ec7', 100000, '0x70a08231000000000000000000000000e2b8e07b913af9ed2b13808e48f2303964276651', '0x68b3465833fb72A70ecDF485E0e4C7bD8665Fc45', '0x04e45aaf000000000000000000000000dac17f958d2ee523a2206206994597c13d831ec7000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc200000000000000000000000000000000000000000000000000000000000001f400000000000000000000000059af55fe00ccc0f0c248510fcc774fdc4919bbbf000000000000000000000000000000000000000000000000000000000000c35000000000000000000000000000000000000000000000000000000000000000640000000000000000000000000000000000000000000000000000000000000000', 100, '0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2'
//     //     //

//     //     vm.startPrank(relayer);
//     //     g.relayAndTransfer(
//     //         0xe2b8e07b913af9ED2b13808e48F2303964276651,
//     //         0xdAC17F958D2ee523a2206206994597C13D831ec7,
//     //         1000000,
//     //         hex"70a08231000000000000000000000000e2b8e07b913af9ed2b13808e48f2303964276651",
//     //         0x68b3465833fb72A70ecDF485E0e4C7bD8665Fc45,
//     //         hex"04e45aaf000000000000000000000000dac17f958d2ee523a2206206994597c13d831ec7000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc200000000000000000000000000000000000000000000000000000000000001f400000000000000000000000059af55fe00ccc0f0c248510fcc774fdc4919bbbf000000000000000000000000000000000000000000000000000000000007a12000000000000000000000000000000000000000000000000000000000000000640000000000000000000000000000000000000000000000000000000000000000",
//     //         1,
//     //         0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2
//     //     );
//     //     vm.stopPrank();
//     //     // assert(address(0xe2b8e07b913af9ED2b13808e48F2303964276651).balance > 0);
//     //     // assertEq(address(g).balance, 0);
//     // }

//     function test_relayIn() external {
//         // function relayIn(
//         //     address _token,
//         //     PermitParams calldata _permitData,
//         //     Permit2Params calldata _permit2Data,
//         //     address _customRouter,
//         //     bytes calldata _swapData,
//         //     uint256 _minAmountOut,
//         //     uint256 _deadline
//         // )

//         // ['0xc2132D05D31c914a87C6611C10748AEb04B58e8F', ('0xe2b8e07b913af9ED2b13808e48F2303964276651', '0x6025381636614b10a13A91B64C74c1176870Ac67', 1000000, 2147483647, 0, '0x0000000000000000000000000000000000000000000000000000000000000000', '0x0000000000000000000000000000000000000000000000000000000000000000'), ((['0x0000000000000000000000000000000000000000', 0], 0, 0), HexBytes('0x00')), '0xE592427A0AEce92De3Edee1F18E0157C05861564', '0xc04b8d59000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000006025381636614b10a13a91b64c74c1176870ac67000000000000000000000000000000000000000000000000000000006670a2cd00000000000000000000000000000000000000000000000000000000000f424000000000000000000000000000000000000000000000000000000000000ef5a80000000000000000000000000000000000000000000000000000000000000042c2132d05d31c914a87c6611c10748aeb04b58e8f0001f40d500b1d8e8ef31e21c99d1db9a6444d3adf12700001f42791bca1f2de4661ed88a30c99a7a9449aa84174000000000000000000000000000000000000000000000000000000000000', 100, 1718657741]

//         Flexy.PermitParams memory permitParams = Flexy.PermitParams(
//             0xe2b8e07b913af9ED2b13808e48F2303964276651,
//             0x6025381636614b10a13A91B64C74c1176870Ac67,
//             1000000,
//             2147483647,
//             0,
//             hex"0000000000000000000000000000000000000000000000000000000000000000",
//             hex"0000000000000000000000000000000000000000000000000000000000000000"
//         );

//         ISignatureTransfer.TokenPermissions
//             memory tokenPermissions = ISignatureTransfer.TokenPermissions(
//                 address(0),
//                 0
//             );
//         ISignatureTransfer.PermitTransferFrom
//             memory permitTransferFrom = ISignatureTransfer.PermitTransferFrom(
//                 tokenPermissions,
//                 0,
//                 0
//             );
//         Flexy.Permit2Params memory permit2Params = Flexy.Permit2Params(
//             permitTransferFrom,
//             hex"00"
//         );

//         // ['0x1AF3F329e8BE154074D8769D1FFa4eE058B1DBc3', ('0xe2b8e07b913af9ED2b13808e48F2303964276651', '0xA5119606318100C5CDCa21622b79719693476B1e', 1000000000000000000, 2147483647, 0, '0x0000000000000000000000000000000000000000000000000000000000000000', '0x0000000000000000000000000000000000000000000000000000000000000000'), ((['0x0000000000000000000000000000000000000000', 0], 0, 0), b''), '0x1b81D678ffb9C0263b24A97847620C99d213eB14', '0xc04b8d59000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000a5119606318100c5cdca21622b79719693476b1e000000000000000000000000000000000000000000000000000000007fffffff0000000000000000000000000000000000000000000000000de0b6b3a76400000000000000000000000000000000000000000000000000000d9b0d78ea620a0000000000000000000000000000000000000000000000000000000000000000421af3f329e8be154074d8769d1ffa4ee058b1dbc30001f4bb4cdb9cbd36b01bd1cbaebf2de08d9173bc095c0001f455d398326f99059ff775485246999027b3197955000000000000000000000000000000000000000000000000000000000000', 980392156862745088, 2147483647]
//         // ['0xB31f66AA3C1e785363F0875A1B74E27b85FD66c7', ('0xe2b8e07b913af9ED2b13808e48F2303964276651', '0xA5119606318100C5CDCa21622b79719693476B1e', 1000000, 2147483647, 0, '0x0000000000000000000000000000000000000000000000000000000000000000', '0x0000000000000000000000000000000000000000000000000000000000000000'), ((['0x0000000000000000000000000000000000000000', 0], 0, 0), b''), '0xE54Ca86531e17Ef3616d22Ca28b0D458b6C89106', '0x38ed173900000000000000000000000000000000000000000000000000000000000f424000000000000000000000000000000000000000000000000000000000000ef5a800000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000a5119606318100c5cdca21622b79719693476b1e000000000000000000000000000000000000000000000000000000007fffffff0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000b31f66aa3c1e785363f0875a1b74e27b85fd66c7000000000000000000000000b97ef9ef8734c71904d8002f8b6bc66dd9c48a6e', 980392, 2147483647]

//         vm.startPrank(relayer);
//         flexy.relayIn(
//             0xB31f66AA3C1e785363F0875A1B74E27b85FD66c7,
//             permitParams,
//             permit2Params,
//             0xE54Ca86531e17Ef3616d22Ca28b0D458b6C89106,
//             hex"38ed173900000000000000000000000000000000000000000000000000000000000f424000000000000000000000000000000000000000000000000000000000000ef5a800000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000a5119606318100c5cdca21622b79719693476b1e000000000000000000000000000000000000000000000000000000007fffffff0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000b31f66aa3c1e785363f0875a1b74e27b85fd66c7000000000000000000000000b97ef9ef8734c71904d8002f8b6bc66dd9c48a6e",
//             980392,
//             2147483647
//         );
//         vm.stopPrank();
//         assert(address(0xe2b8e07b913af9ED2b13808e48F2303964276651).balance > 0);
//         // assertEq(address(g).balance, 0);
//     }

//     function test_transferOut() external {
//         // function transferOut(
//         //     address _outputToken,
//         //     address _recipient,
//         //     address _customRouter,
//         //     bytes calldata _swapData,
//         //     uint256 _swapAmount,
//         //     uint256 _minAmountOut,
//         //     uint256 outbound_id,
//         //     uint256 _gasLimit,
//         //     uint256 _deadline
//         // )

//         // ['0x3c499c542cEF5E3811e1192ce70d8cC03d5c3359', '0x1B7FE02Da6c7a7175a33D109397492c2872c6A5e', '0xE592427A0AEce92De3Edee1F18E0157C05861564', '0xc04b8d59000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000b19e4c6e95c49ab00d925c716ed1a1cb7d9e67500000000000000000000000000000000000000000000000000000000665e076b00000000000000000000000000000000000000000000000000000000000a60400000000000000000000000000000000000000000000000000cdc900af111600000000000000000000000000000000000000000000000000000000000000000422791bca1f2de4661ed88a30c99a7a9449aa841740001f40d500b1d8e8ef31e21c99d1db9a6444d3adf12700001f43c499c542cef5e3811e1192ce70d8cc03d5c3359000000000000000000000000000000000000000000000000000000000000', 680000, 926774000000000000, 1224, 30000, 1717438315]
//         // ['0x82f0B8B456c1A451378467398982d4834b6829c1', '0x1B7FE02Da6c7a7175a33D109397492c2872c6A5e', '0xF491e7B69E4244ad4002BC14e878a34207E38c29', '0x38ed173900000000000000000000000000000000000000000000000000000000000a60400000000000000000000000000000000000000000000000000b25d115c5e2e00000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000b19e4c6e95c49ab00d925c716ed1a1cb7d9e67500000000000000000000000000000000000000000000000000000000665e0a2700000000000000000000000000000000000000000000000000000000000000030000000000000000000000001b6382dbdea11d97f24495c9a90b7c88469134a400000000000000000000000021be370d5312f44cb42ce377bc9b8a0cef1a4c8300000000000000000000000082f0b8b456c1a451378467398982d4834b6829c1', 680000, 803278000000000000, 1225, 30000, 1717439015]
//         // ['0x4200000000000000000000000000000000000006', '0xe2b8e07b913af9ED2b13808e48F2303964276651', '0xE592427A0AEce92De3Edee1F18E0157C05861564', '0xc04b8d59000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000006025381636614b10a13a91b64c74c1176870ac67000000000000000000000000000000000000000000000000000000006673363200000000000000000000000000000000000000000000000000000000000f42400000000000000000000000000000000000000000000000000000fa0c2a20a9d700000000000000000000000000000000000000000000000000000000000000420b2c639c533813f4aa9d7837caf62653d097ff850001f442000000000000000000000000000000000000060001f44200000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000', 1000000, 274930153335255, 9999999999, 30000, 1718826546]
//         // ['0x0d500B1d8E8eF31E21C99d1Db9A6444d3ADf1270', '0x1B7FE02Da6c7a7175a33D109397492c2872c6A5e', '0xE592427A0AEce92De3Edee1F18E0157C05861564', '0xc04b8d59000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000006025381636614b10a13a91b64c74c1176870ac670000000000000000000000000000000000000000000000000000000066746dd000000000000000000000000000000000000000000000000000000000004769400000000000000000000000000000000000000000000000006ee3fe9c3a81a65200000000000000000000000000000000000000000000000000000000000000422791bca1f2de4661ed88a30c99a7a9449aa841740001f40d500b1d8e8ef31e21c99d1db9a6444d3adf12700001f40d500b1d8e8ef31e21c99d1db9a6444d3adf1270000000000000000000000000000000000000000000000000000000000000', 4680000, 7990510110835320402, 1319, 30000, 1718906320]
//         // ['0xFd086bC7CD5C481DCC9C85ebE478A1C0b69FCbb9', '0xe2b8e07b913af9ED2b13808e48F2303964276651', '0xE592427A0AEce92De3Edee1F18E0157C05861564', '0xc04b8d59000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000a5119606318100c5cdca21622b79719693476b1e000000000000000000000000000000000000000000000000000000007fffffff00000000000000000000000000000000000000000000000000000000000f42400000000000000000000000000000000000000000000000000d9b0d78ea6209f8000000000000000000000000000000000000000000000000000000000000002baf88d065e77c8cc2239327c5edb3a432268e58310001f482af49447d8a07e3bd95bd0d56f35241523fbab1000000000000000000000000000000000000000000', 1000000, 980392156862745080, 9999999999, 30000, 2147483647]
//         // ['0xFd086bC7CD5C481DCC9C85ebE478A1C0b69FCbb9', '0xe2b8e07b913af9ED2b13808e48F2303964276651', '0xE592427A0AEce92De3Edee1F18E0157C05861564', '0xc04b8d59000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000a5119606318100c5cdca21622b79719693476b1e000000000000000000000000000000000000000000000000000000007fffffff00000000000000000000000000000000000000000000000000000000000f42400000000000000000000000000000000000000000000000000d9b0d78ea6209f8000000000000000000000000000000000000000000000000000000000000002baf88d065e77c8cc2239327c5edb3a432268e58310001f482af49447d8a07e3bd95bd0d56f35241523fbab1000000000000000000000000000000000000000000', 1000000, 980392156862745080, 9999999999, 30000, 2147483647]

//         vm.startPrank(relayer);
//         flexy.transferOut(
//             0xFd086bC7CD5C481DCC9C85ebE478A1C0b69FCbb9,
//             0xe2b8e07b913af9ED2b13808e48F2303964276651,
//             0xE592427A0AEce92De3Edee1F18E0157C05861564,
//             hex"c04b8d59000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000a5119606318100c5cdca21622b79719693476b1e000000000000000000000000000000000000000000000000000000007fffffff00000000000000000000000000000000000000000000000000000000000f42400000000000000000000000000000000000000000000000000d9b0d78ea6209f8000000000000000000000000000000000000000000000000000000000000002baf88d065e77c8cc2239327c5edb3a432268e58310001f482af49447d8a07e3bd95bd0d56f35241523fbab1000000000000000000000000000000000000000000",
//             1000000,
//             980392156862745080,
//             9999999999,
//             30000,
//             2147483647
//         );

//         // flexy.transferOut(
//         //     0x82f0B8B456c1A451378467398982d4834b6829c1,
//         //     0x1B7FE02Da6c7a7175a33D109397492c2872c6A5e,
//         //     0xF491e7B69E4244ad4002BC14e878a34207E38c29,
//         //     hex"38ed173900000000000000000000000000000000000000000000000000000000000a60400000000000000000000000000000000000000000000000000b25d115c5e2e00000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000b19e4c6e95c49ab00d925c716ed1a1cb7d9e67500000000000000000000000000000000000000000000000000000000665e0a2700000000000000000000000000000000000000000000000000000000000000030000000000000000000000001b6382dbdea11d97f24495c9a90b7c88469134a400000000000000000000000021be370d5312f44cb42ce377bc9b8a0cef1a4c8300000000000000000000000082f0b8b456c1a451378467398982d4834b6829c1",
//         //     680000,
//         //     803278000000000000,
//         //     1225,
//         //     30000,
//         //     1717439015
//         // );
//         vm.stopPrank();
//         assert(address(0xe2b8e07b913af9ED2b13808e48F2303964276651).balance > 0);
//         // assertEq(address(g).balance, 0);
//     }
// }
